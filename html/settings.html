<!DOCTYPE html>
<html>
  <head>
    <title>Settings</title>
    <link rel="stylesheet" href="../css/settings.css" />
  </head>
  <body>
    <div id="cocktail-machine">
      <a href="menu.html" class="back-btn">&larr; Back</a>
      <h1>Settings</h1>
      <h2>Pump Assignment</h2>
      <form id="pumpAssignmentForm">
        <label for="pump1">Pump 1:</label>
        <select id="pump1" name="pump1">
          <option value="">Select Ingredients</option>
          <optgroup label="Liquors">
            <option value="Whiskey">Whiskey</option>
            <option value="Gin">Gin</option>
            <option value="Amaretto">Amaretto</option>
            <option value="CrownRoyal">Crown Royal</option>
            <option value="Vodka">Vodka</option>
            <option value="Rum">Rum</option>
            <option value="Tequila">Tequila</option>
            <option value="Brandy">Brandy</option>
            <option value="Liqueur">Liqueur</option>
            <option value="TripleSec">Triple Sec</option>
          </optgroup>
          <optgroup label="Sodas/Juices">
            <option value="CocaCola">Coca-Cola</option>
            <option value="DrPepper">Dr.Pepper</option>
            <option value="Sprite">Sprite</option>
            <option value="CranberryJuice">Cranberry Juice</option>
            <option value="AppleJuice">Apple Juice</option>
            <option value="LimeJuice">Lime Juice</option>
            <option value="LemonJuice">Lemon Juice</option>
            <option value="SweetAndSourMix">Sweet & Sour Mix</option>
            <option value="Water">Water</option>
          </optgroup>
        </select>

        <label for="pump2">Pump 2:</label>
        <select id="pump2" name="pump2">
          <option value="">Select Ingredients</option>
          <optgroup label="Liquors">
            <option value="Whiskey">Whiskey</option>
            <option value="Gin">Gin</option>
            <option value="Amaretto">Amaretto</option>
            <option value="CrownRoyal">Crown Royal</option>
            <option value="Vodka">Vodka</option>
            <option value="Rum">Rum</option>
            <option value="Tequila">Tequila</option>
            <option value="Brandy">Brandy</option>
            <option value="Liqueur">Liqueur</option>
            <option value="TripleSec">Triple Sec</option>
          </optgroup>
          <optgroup label="Sodas/Juices">
            <option value="CocaCola">Coca-Cola</option>
            <option value="DrPepper">Dr.Pepper</option>
            <option value="Sprite">Sprite</option>
            <option value="CranberryJuice">Cranberry Juice</option>
            <option value="AppleJuice">Apple Juice</option>
            <option value="LimeJuice">Lime Juice</option>
            <option value="LemonJuice">Lemon Juice</option>
            <option value="SweetAndSourMix">Sweet & Sour Mix</option>
            <option value="Water">Water</option>
          </optgroup>
        </select>

        <label for="pump3">Pump 3:</label>
        <select id="pump3" name="pump3">
          <option value="">Select Ingredients</option>
          <optgroup label="Liquors">
            <option value="Whiskey">Whiskey</option>
            <option value="Gin">Gin</option>
            <option value="Amaretto">Amaretto</option>
            <option value="CrownRoyal">Crown Royal</option>
            <option value="Vodka">Vodka</option>
            <option value="Rum">Rum</option>
            <option value="Tequila">Tequila</option>
            <option value="Brandy">Brandy</option>
            <option value="Liqueur">Liqueur</option>
            <option value="TripleSec">Triple Sec</option>
          </optgroup>
          <optgroup label="Sodas/Juices">
            <option value="CocaCola">Coca-Cola</option>
            <option value="DrPepper">Dr.Pepper</option>
            <option value="Sprite">Sprite</option>
            <option value="CranberryJuice">Cranberry Juice</option>
            <option value="AppleJuice">Apple Juice</option>
            <option value="LimeJuice">Lime Juice</option>
            <option value="LemonJuice">Lemon Juice</option>
            <option value="SweetAndSourMix">Sweet & Sour Mix</option>
            <option value="Water">Water</option>
          </optgroup>
        </select>

        <label for="pump4">Pump 4:</label>
        <select id="pump4" name="pump4">
          <option value="">Select Ingredients</option>
          <optgroup label="Liquors">
            <option value="Whiskey">Whiskey</option>
            <option value="Gin">Gin</option>
            <option value="Amaretto">Amaretto</option>
            <option value="CrownRoyal">Crown Royal</option>
            <option value="Vodka">Vodka</option>
            <option value="Rum">Rum</option>
            <option value="Tequila">Tequila</option>
            <option value="Brandy">Brandy</option>
            <option value="Liqueur">Liqueur</option>
            <option value="TripleSec">Triple Sec</option>
          </optgroup>
          <optgroup label="Sodas/Juices">
            <option value="CocaCola">Coca-Cola</option>
            <option value="DrPepper">Dr.Pepper</option>
            <option value="Sprite">Sprite</option>
            <option value="CranberryJuice">Cranberry Juice</option>
            <option value="AppleJuice">Apple Juice</option>
            <option value="LimeJuice">Lime Juice</option>
            <option value="LemonJuice">Lemon Juice</option>
            <option value="SweetAndSourMix">Sweet & Sour Mix</option>
            <option value="Water">Water</option>
          </optgroup>
        </select>

        <button type="submit">Save</button>
        <div id="successAlert" class="alert alert-success" style="display: none;">
          Settings saved successfully!
        </div>
      </form>

      <h2>Activate Pumps</h2>
      <form id="pumpActivationForm">
        <label for="pump1">Pump 1:</label>
        <label class="switch">
          <input type="checkbox" id="pump1" name="pump1" />
          <span class="slider"></span>
        </label>

        <label for="pump2">Pump 2:</label>
        <label class="switch">
          <input type="checkbox" id="pump2" name="pump2" />
          <span class="slider"></span>
        </label>

        <label for="pump3">Pump 3:</label>
        <label class="switch">
          <input type="checkbox" id="pump3" name="pump3" />
          <span class="slider"></span>
        </label>

        <label for="pump4">Pump 4:</label>
        <label class="switch">
          <input type="checkbox" id="pump4" name="pump4" />
          <span class="slider"></span>
        </label>
      </form>

      <form id="cleanForm">
        <h2>Clean Machine</h2>
        <label class="switch">
          <input type="checkbox" id="clean" name="clean" />
          <span class="slider"></span>
        </label>
      </form>
    </div>
    <script>
      // Retrieve the stored form data from localStorage
      var storedFormData = localStorage.getItem("formData");
      if (storedFormData) {
        var formData = JSON.parse(storedFormData);
        // Assign the values to the pumpAssignment form
        document.getElementById("pump1").value = formData.pump1;
        document.getElementById("pump2").value = formData.pump2;
        document.getElementById("pump3").value = formData.pump3;
        document.getElementById("pump4").value = formData.pump4;
      }

      document
        .getElementById("pumpActivationForm")
        .querySelectorAll('.switch input[type="checkbox"]')
        .forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
        if (this.checked) {
          var status = "on";
        } else {
          var status = "off";
        }
        fetch("http://localhost:5000/pump_control", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            pumpId: this.id,
            status: status,
          }),
        })
          .then((response) => response.json())
          .then((data) => console.log(data))
          .catch((error) => {
            console.error("Error:", error);
          });
          });
        });

      document
        .getElementById("pumpAssignmentForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          var formElements = this.elements;
          var formData = {};

          for (var i = 0; i < formElements.length; i++) {
            if (formElements[i].type !== "submit") {
              // we don't want to include the submit button
              formData[formElements[i].name] = formElements[i].value;
            }
          }

          localStorage.setItem("formData", JSON.stringify(formData));
          document.getElementById("successAlert").style.display = "block";
          setTimeout(function () {
            document.getElementById("successAlert").style.display = "none";
          }, 3000);

        });

        document
        .getElementById("cleanForm")
        .querySelectorAll('.switch input[type="checkbox"]')
        .forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
        if (this.checked) {
          var status = "on";
        } else {
          var status = "off";
        }
        fetch("http://localhost:5000/clean", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            pumpId: this.id,
            status: status,
          }),
        })
          .then((response) => response.json())
          .then((data) => console.log(data))
          .catch((error) => {
            console.error("Error:", error);
          });
          });
        });
        </script>
    </script>
  </body>
</html>
